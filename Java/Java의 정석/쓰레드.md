# 쓰레드(Thread)
: 프로세스[^1]의 자원을 이용해서 실제로 작업을 수행하는 것이 쓰레드[^2]이다.
- 모든 프로세스에서는 최소한 하나 이상의 쓰레드가 존재하며, 둘 아상의 쓰레드를 가진 프로세스를 '멀티쓰레드 프로세스'라고한다.
> 프로세스(process): 실행중인 프로그램, 프로그램을 실행하면 OS로부터 실행에 필요한 메모리를 할당 받아 프로세스가 된다.

### 쓰레드 구현과 실행
- Runnable 인터페이스를 구현하는 방법이 일반적이다.

1. Thread클래스를 상속
```java
class MyThread extends Thread{
	public void run(){ }// Thread클래스의 run()을 오버라이딩
}
```
2. Runnable인터페이스를 구현
```java
class MyThread implements Runnable{
	public void run(){ } // Runnable인터페이스의 run()을 구현
}
```

실행

- 한 번 실행이 종료된 쓰레드는 다시 실행할 수 없다, 하나의 쓰레드에 대해 `start()`가 한 번만 호출될 수 있다.

```java
ThreadEx t1 - new ThreadEx(); // 쓰레드 t1을 생성한다.

t1.start(); // 쓰레드 t1을 실행시긴다.
```

### 쓰레드의 우선순위

```java
void setPriority(int newPriority) // 쓰레드의 우선순위를 지정한 값으로 변경
int getPriority() // 쓰레드의 우선순위를 반환
```

쓰레드가 가질 수 있는 우선순위의 범위는 1~10이며, main메서드를 수행하는 쓰레드는 우선순위가 5이므로 main메서드 내에서 생성하는 쓰레드의 우선순위는 자동적으로 5가 된다.[^3]



### 데몬 쓰레드(daemon Thread)

: 일반 쓰레드의 작업을 돕는 보조적인 역할을 수행하는 쓰레드, 일반 쓰레드가 모두 종료되면 데몬 쓰레드는 자동으로 종료

> 가비지 컬렉터, 워드프로세서의 자동저장, 화면자동갱신 등

### 쓰레드의 동기화

: 특정 작업을 끝마치기 전까지 다른 쓰레드에 의해 방해받지 않도록 하는 것[^4][^5] (임계영역, 락)

#### synchronized를 이용한 동기화

1. 메서드 전체를 임계 영역으로 지정

   : 쓰레드는 synchronized메서드가 호출된 시점부터 해당 메서드가 포함된 객체의 lock을 얻어 작업을 수행하다가 메서드가 종료되면 lock을 반환

   ```java
   public synchronized void calcSum(){
       //...
   }
   ```

2. 특정한 영역을 임계 영역으로 지정

   : 블럭안으로 들어가면서부터 쓰레드는 지정된 객체의 lockdmf 얻고, 블럭을 벗어나면 lock을 반납

   ```java
   synchronized(객체의 참조변수){
       //...
   }
   ```



#### wait(), notify()

1. 동기화 된 임계 영역의 코드를 수행하다가 작업을 더 이상 진행할 상황이 아니면, 일단 wait()을 호출하여 쓰레드가 락을 반납하고 기다리게 한다. 

2. 그러면 다른 쓰레드가 락을 얻어 해당 객체에 대한 작업을 수행할 수 있게 된다. 

3. 나중에 작업을 진행할 수 있는 상황이 되면 notify()를 호출해서, 작업을 중단했던 쓰레드가 다시 락을 얻어 작업을 진행할 수 있게 된다.

- 매개변수가 있는 wai()은 지정된 시간이 지난 후에 자동적으로 notify()가 호출되는 것과 같다.



[^1]: 공장
[^2]: 일꾼
[^3]: 클수록 높음
[^4]: 멀티쓰레드 프로세스의 경우 같은 프로세스의 자원을 공유해서 작업하기 때문에 서로의 작업에 영향을 주게된다.
[^5]: 쓰레드A가 작업하던 공유데이터를 쓰레드B가 임의로 변경하였다면, 다시 쓰레드A가 제어권을 받아서 나머지 작업을 마쳤을 때 원래 의도했던 것과는 다른 결과를 얻을 수 있다.

